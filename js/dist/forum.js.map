{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/emojionearea/./src/forum/index.ts","webpack://@clarkwinkelmann/emojionearea/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@clarkwinkelmann/emojionearea/external root \"flarum.core.compat['common/components/TextEditorButton']\"","webpack://@clarkwinkelmann/emojionearea/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/emojionearea/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/emojionearea/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@clarkwinkelmann/emojionearea/webpack/bootstrap","webpack://@clarkwinkelmann/emojionearea/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/emojionearea/webpack/runtime/define property getters","webpack://@clarkwinkelmann/emojionearea/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/emojionearea/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/emojionearea/./forum.js"],"sourcesContent":["import {extend} from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport TextEditor from 'flarum/common/components/TextEditor';\nimport TextEditorButton from 'flarum/common/components/TextEditorButton';\n\nconst translationPrefix = 'clarkwinkelmann-emojionearea.forum.';\n\nlet emojioneAreaLoaded = false;\n\nfunction loadEmojioneArea() {\n    if (emojioneAreaLoaded) {\n        return Promise.resolve();\n    }\n\n    emojioneAreaLoaded = true;\n\n    return new Promise(resolve => {\n        const style = document.createElement('link');\n        style.rel = 'stylesheet';\n        style.crossOrigin = 'anonymous';\n        style.integrity = 'sha256-LKawN9UgfpZuYSE2HiCxxDxDgLOVDx2R4ogilBI52oc=';\n        style.href = 'https://cdn.jsdelivr.net/npm/emojionearea@3.4.2/dist/emojionearea.min.css';\n        document.head.appendChild(style);\n\n        const script = document.createElement('script');\n        script.crossOrigin = 'anonymous';\n        script.integrity = 'sha256-ImIFrmJd7ymGlVw2MbtI96BNPW4NfcKqM3d1Go665Ig=';\n        script.src = 'https://cdn.jsdelivr.net/npm/emojionearea@3.4.2/dist/emojionearea.min.js';\n        script.onload = resolve;\n        document.body.appendChild(script);\n    });\n}\n\napp.initializers.add('clarkwinkelmann-emojionearea', () => {\n    TextEditor.prototype.emojioneAreaClickedOutside = function (event) {\n        // If a click is triggered before the picker is ready, do not do anything\n        if (!this.emojioneArea || !this.emojioneArea.isReady) {\n            return;\n        }\n\n        const $target = $<any>(event.target);\n\n        // If we clicked on the popup or the editor button we don't do anything\n        if ($target.is('.emojionearea') || $target.parents('.emojionearea').length || $target.parents('.Button-emojionearea').length) {\n            return;\n        }\n\n        this.emojioneArea.hidePicker();\n    }\n\n    TextEditor.prototype.configureEmojioneArea = function () {\n        if (this.emojioneArea) {\n            return Promise.resolve();\n        }\n\n        const $container = $('<div class=\"ComposerBody-emojioneareaContainer\"/>');\n        this.$('.TextEditor-controls').before($container);\n\n        return new Promise(resolve => {\n            const filters: any = {};\n\n            Object.keys($().emojioneArea.defaults.filters).forEach(filter => {\n                const key = translationPrefix + 'filters.' + filter;\n\n                if (key in app.translator.translations) {\n                    filters[filter] = {\n                        title: app.translator.trans(key),\n                    };\n                }\n            });\n\n            const area = $('<div />').emojioneArea({\n                standalone: true, // Popup only mode\n                sprite: false, // Undocumented setting, but disabling it removes an unnecessary CSS file load\n                hidePickerOnBlur: false, // We do our own \"click outside\" detection since we have a custom opening button\n                searchPlaceholder: app.translator.trans(translationPrefix + 'search_placeholder'),\n                buttonTitle: app.translator.trans(translationPrefix + 'picker_button'),\n                container: $container,\n                filters,\n                events: { // Listen for clicks to sync with Flarum editor\n                    emojibtn_click: () => {\n                        // To get the Unicode value, we need to pull it from the invisible insert area\n                        this.attrs.composer.editor.insertAtCursor(this.emojioneArea!.getText());\n\n                        if (app.forum.attribute('emojioneAreaCloseOnPick')) {\n                            this.emojioneArea!.hidePicker();\n                        }\n                    },\n                    ready: resolve,\n                },\n                ...app.forum.attribute('emojioneAreaConfig'),\n            });\n\n            this.emojioneArea = area.data('emojioneArea');\n        });\n    }\n\n    extend(TextEditor.prototype, 'oncreate', function () {\n        this.emojioneArea = null;\n        this.emojioneAreaLoading = false;\n\n        document.addEventListener('click', this.emojioneAreaClickedOutside.bind(this));\n    });\n\n    extend(TextEditor.prototype, 'onremove', function () {\n        document.removeEventListener('click', this.emojioneAreaClickedOutside);\n    });\n\n    extend(TextEditor.prototype, 'toolbarItems', function (items) {\n        items.add('clarkwinkelmann-emojionearea', TextEditorButton.component({\n            onclick: () => {\n                // Prevent double-clicks while the library is loading\n                if (this.emojioneAreaLoading) {\n                    return;\n                }\n\n                if (this.emojioneArea && this.emojioneArea.button.is('.active')) {\n                    this.emojioneArea.hidePicker();\n                } else {\n                    this.emojioneAreaLoading = true;\n\n                    loadEmojioneArea().then(() => {\n                        this.configureEmojioneArea().then(() => {\n                            const position = this.$('.Button-emojionearea').position();\n                            this.$('.emojionearea-picker').css('left', position.left - 290);\n                            this.emojioneArea!.showPicker();\n\n                            // Focus EmojiOneArea search bar after opening\n                            $('.emojionearea-search input').focus();\n\n                            this.emojioneAreaLoading = false;\n                            m.redraw();\n                        });\n                    });\n                }\n            },\n            className: 'Button Button--icon Button--link Button-emojionearea',\n            icon: this.emojioneAreaLoading ? 'fas fa-spinner fa-pulse' : 'far fa-smile-beam',\n            title: app.translator.trans(translationPrefix + 'picker_button'),\n        }));\n    });\n});\n\napp.initializers.add('clarkwinkelmann-emojionearea-after', () => {\n    extend(TextEditor.prototype, 'toolbarItems', function (items) {\n        if (app.forum.attribute('emojioneAreaHideFlarumButton') && items.has('emoji')) {\n            items.remove('emoji');\n        }\n    });\n}, -100); // Since flarum/emoji does not run with any special priority, any negative value should work\n","module.exports = flarum.core.compat['common/components/TextEditor'];","module.exports = flarum.core.compat['common/components/TextEditorButton'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['forum/app'];","function _extends() {\n  return _extends = Object.assign ? Object.assign.bind() : function (n) {\n    for (var e = 1; e < arguments.length; e++) {\n      var t = arguments[e];\n      for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\n    }\n    return n;\n  }, _extends.apply(null, arguments);\n}\nexport { _extends as default };","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './src/forum';\n"],"names":["extend","app","TextEditor","TextEditorButton","translationPrefix","emojioneAreaLoaded","loadEmojioneArea","Promise","resolve","style","document","createElement","rel","crossOrigin","integrity","href","head","appendChild","script","src","onload","body","initializers","add","prototype","emojioneAreaClickedOutside","event","emojioneArea","isReady","$target","$","target","is","parents","length","hidePicker","configureEmojioneArea","_this","$container","before","filters","Object","keys","defaults","forEach","filter","key","translator","translations","title","trans","area","_extends","standalone","sprite","hidePickerOnBlur","searchPlaceholder","buttonTitle","container","events","emojibtn_click","attrs","composer","editor","insertAtCursor","getText","forum","attribute","ready","data","emojioneAreaLoading","addEventListener","bind","removeEventListener","items","_this2","component","onclick","button","then","position","css","left","showPicker","focus","m","redraw","className","icon","has","remove","assign","n","e","arguments","t","r","hasOwnProperty","call","apply","default"],"sourceRoot":""}